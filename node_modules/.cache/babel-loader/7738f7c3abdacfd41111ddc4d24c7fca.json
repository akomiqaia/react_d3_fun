{"ast":null,"code":"var _jsxFileName = \"/home/ako/Documents/git/react_d3_fun/src/components/circle.js\";\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\n\nconst Circle = () => {\n  const ref = useRef();\n  useEffect(() => {\n    // runs d3 code when the Component mounths\n    const svgElement = d3.select(ref.current); // turn our ref into d3 object\n\n    drawBars();\n    svgElement.append(\"circle\") //append a circle\n    .attr(\"cx\", 150).attr(\"cy\", 70).attr(\"r\", 50);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 12\n    }\n  });\n};\n\nasync function drawBars() {\n  // 1. Access data\n  let dataset = await d3.csv(\"../utils/data.csv\");\n\n  const summaryAccessor = d => d.Summary;\n\n  const actualHoursAccessor = d => +d.HoursActual;\n\n  const developerHoursAccessor = d => +d.DeveloperHoursActual; // Only use the first estimate per task (with highest actual hours)\n\n\n  let usedTasks = {};\n  dataset = dataset.filter(d => {\n    const hours = actualHoursAccessor(d);\n\n    if (usedTasks[summaryAccessor(d)]) {\n      const hasHigherValue = hours > usedTasks[summaryAccessor(d)];\n      if (!hasHigherValue) return false;\n    }\n\n    usedTasks[summaryAccessor(d)] = hours;\n    return actualHoursAccessor(d) > 10;\n  });\n\n  const diffAccessor = d => +d.HoursEstimate - actualHoursAccessor(d);\n\n  dataset = dataset.filter(d => diffAccessor(d) >= -50 && diffAccessor(d) <= 50);\n\n  const yAccessor = d => d.length; // 2. Create chart dimensions\n\n\n  const width = 600;\n  let dimensions = {\n    width: width,\n    height: width * 0.5,\n    margin: {\n      top: 35,\n      right: 10,\n      bottom: 50,\n      left: 50\n    }\n  };\n  dimensions.boundedWidth = dimensions.width - dimensions.margin.left - dimensions.margin.right;\n  dimensions.boundedHeight = dimensions.height - dimensions.margin.top - dimensions.margin.bottom; // 3. Draw canvas\n\n  const wrapper = d3.select(\"#wrapper\").append(\"svg\").attr(\"width\", dimensions.width).attr(\"height\", dimensions.height);\n  const bounds = wrapper.append(\"g\").style(\"transform\", `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`);\n  const background = bounds.append(\"g\"); // init static elements\n\n  bounds.append(\"g\").attr(\"class\", \"bins\");\n  bounds.append(\"line\").attr(\"class\", \"mean\");\n  bounds.append(\"g\").attr(\"class\", \"x-axis\").style(\"transform\", `translateY(${dimensions.boundedHeight}px)`).append(\"text\").attr(\"class\", \"x-axis-label\"); // 4. Create scales\n\n  const xScale = d3.scaleLinear().domain(d3.extent(dataset, diffAccessor)).range([0, dimensions.boundedWidth]).nice();\n  const binsGenerator = d3.histogram().domain(xScale.domain()).value(diffAccessor).thresholds(30);\n  const bins = binsGenerator(dataset);\n  const yScale = d3.scaleLinear().domain([0, d3.max(bins, yAccessor)]).range([dimensions.boundedHeight, 0]).nice(); // 5. Draw data\n\n  const barPadding = 1.5;\n  let binGroups = bounds.select(\".bins\").selectAll(\".bin\").data(bins);\n  binGroups.exit().remove();\n  const newBinGroups = binGroups.enter().append(\"g\").attr(\"class\", \"bin\");\n  newBinGroups.append(\"rect\"); // update binGroups to include new points\n\n  binGroups = newBinGroups.merge(binGroups);\n  const barRects = binGroups.select(\"rect\").attr(\"key\", (d, i) => i).attr(\"x\", d => xScale(d.x0) + barPadding).attr(\"y\", d => yScale(yAccessor(d))).attr(\"height\", d => dimensions.boundedHeight - yScale(yAccessor(d))).attr(\"width\", d => d3.max([0, xScale(d.x1) - xScale(d.x0) - barPadding]));\n  const mean = d3.mean(dataset, diffAccessor);\n  const meanLine = bounds.selectAll(\".mean\").attr(\"x1\", xScale(mean)).attr(\"x2\", xScale(mean)).attr(\"y1\", -20).attr(\"y2\", dimensions.boundedHeight);\n  const meanLabel = bounds.append(\"text\").attr(\"class\", \"mean-label\").attr(\"x\", xScale(mean)).attr(\"y\", -25).text(\"mean\"); // 6. Draw peripherals\n\n  const xAxisGenerator = d3.axisBottom().scale(xScale);\n  const xAxis = bounds.select(\".x-axis\").call(xAxisGenerator);\n  const xAxisLabel = xAxis.select(\".x-axis-label\").attr(\"x\", dimensions.boundedWidth / 2).attr(\"y\", dimensions.margin.bottom - 10).text(\"Hours over-estimated\");\n  const backgroundLeft = background.append(\"rect\").attr(\"class\", \"background left-side-background\").attr(\"y\", -20).attr(\"width\", dimensions.boundedWidth / 2).attr(\"height\", dimensions.boundedHeight + 20);\n  const backgroundRight = background.append(\"rect\").attr(\"class\", \"background right-side-background\").attr(\"x\", dimensions.boundedWidth / 2 + 1).attr(\"y\", -20).attr(\"width\", dimensions.boundedWidth / 2 - 1).attr(\"height\", dimensions.boundedHeight + 20);\n  const leftSideLabel = background.append(\"text\").attr(\"class\", \"label left-side-label\").attr(\"x\", 10).attr(\"y\", 0).text(\"Under-estimated\");\n  const rightSideLabel = background.append(\"text\").attr(\"class\", \"label right-side-label\").attr(\"x\", dimensions.boundedWidth - 10).attr(\"y\", 0).text(\"Over-estimated\"); // 7. Set up interactions\n\n  const barRectsListeners = bounds.selectAll(\".listeners\").data(bins).enter().append(\"rect\").attr(\"class\", \"listeners\").attr(\"x\", d => xScale(d.x0)).attr(\"y\", -dimensions.margin.top).attr(\"height\", dimensions.boundedHeight + dimensions.margin.top).attr(\"width\", d => d3.max([0, xScale(d.x1) - xScale(d.x0)])).on(\"mouseenter\", onMouseEnter).on(\"mouseleave\", onMouseLeave);\n  const tooltip = d3.select(\"#tooltip\");\n\n  function onMouseEnter(datum, index) {\n    tooltip.select(\"#range\").text([datum.x0 < 0 ? `Under-estimated by` : `Over-estimated by`, Math.abs(datum.x0), \"to\", Math.abs(datum.x1), \"hours\"].join(\" \"));\n    tooltip.select(\"#examples\").html(datum.slice(0, 3).map(summaryAccessor).join(\"<br />\"));\n    tooltip.select(\"#count\").text(Math.max(0, yAccessor(datum) - 2));\n    const percentDeveloperHoursValues = datum.map(d => developerHoursAccessor(d) / actualHoursAccessor(d) || 0);\n    const percentDeveloperHours = d3.mean(percentDeveloperHoursValues);\n\n    const formatHours = d => d3.format(\",.2f\")(Math.abs(d));\n\n    tooltip.select(\"#tooltip-bar-value\").text(formatHours(percentDeveloperHours));\n    tooltip.select(\"#tooltip-bar-item-1\").style(\"width\", `${percentDeveloperHours * 100}%`);\n    const x = xScale(datum.x0) + (xScale(datum.x1) - xScale(datum.x0)) / 2 + dimensions.margin.left;\n    const y = yScale(yAccessor(datum)) + dimensions.margin.top;\n    tooltip.style(\"transform\", `translate(` + `calc( -50% + ${x}px),` + `calc(-100% + ${y}px)` + `)`);\n    tooltip.style(\"opacity\", 1);\n    const hoveredBar = binGroups.select(`rect[key='${index}']`);\n    hoveredBar.classed(\"hovered\", true);\n  }\n\n  function onMouseLeave() {\n    tooltip.style(\"opacity\", 0);\n    barRects.classed(\"hovered\", false);\n  }\n}\n\nexport default Circle;","map":{"version":3,"sources":["/home/ako/Documents/git/react_d3_fun/src/components/circle.js"],"names":["React","useRef","useEffect","useState","d3","Circle","ref","svgElement","select","current","drawBars","append","attr","dataset","csv","summaryAccessor","d","Summary","actualHoursAccessor","HoursActual","developerHoursAccessor","DeveloperHoursActual","usedTasks","filter","hours","hasHigherValue","diffAccessor","HoursEstimate","yAccessor","length","width","dimensions","height","margin","top","right","bottom","left","boundedWidth","boundedHeight","wrapper","bounds","style","background","xScale","scaleLinear","domain","extent","range","nice","binsGenerator","histogram","value","thresholds","bins","yScale","max","barPadding","binGroups","selectAll","data","exit","remove","newBinGroups","enter","merge","barRects","i","x0","x1","mean","meanLine","meanLabel","text","xAxisGenerator","axisBottom","scale","xAxis","call","xAxisLabel","backgroundLeft","backgroundRight","leftSideLabel","rightSideLabel","barRectsListeners","on","onMouseEnter","onMouseLeave","tooltip","datum","index","Math","abs","join","html","slice","map","percentDeveloperHoursValues","percentDeveloperHours","formatHours","format","x","y","hoveredBar","classed"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,MAAf,EAAuBC,SAAvB,EAAkCC,QAAlC,QAAiD,OAAjD;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;;AAEA,MAAMC,MAAM,GAAG,MAAM;AACjB,QAAMC,GAAG,GAAGL,MAAM,EAAlB;AACAC,EAAAA,SAAS,CAAC,MAAM;AAAE;AACd,UAAMK,UAAU,GAAGH,EAAE,CAACI,MAAH,CAAUF,GAAG,CAACG,OAAd,CAAnB,CADY,CAC8B;;AAC1CC,IAAAA,QAAQ;AACRH,IAAAA,UAAU,CAACI,MAAX,CAAkB,QAAlB,EAA4B;AAA5B,KACKC,IADL,CACU,IADV,EACgB,GADhB,EAEKA,IAFL,CAEU,IAFV,EAEgB,EAFhB,EAGKA,IAHL,CAGU,GAHV,EAGe,EAHf;AAIH,GAPQ,EAON,EAPM,CAAT;AAQA,sBACO;AACC,IAAA,GAAG,EAAEN,GADN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADP;AAMH,CAhBD;;AAiBA,eAAeI,QAAf,GAA0B;AACtB;AACE,MAAIG,OAAO,GAAG,MAAMT,EAAE,CAACU,GAAH,CAAO,mBAAP,CAApB;;AACA,QAAMC,eAAe,GAAGC,CAAC,IAAIA,CAAC,CAACC,OAA/B;;AACA,QAAMC,mBAAmB,GAAGF,CAAC,IAAI,CAACA,CAAC,CAACG,WAApC;;AACA,QAAMC,sBAAsB,GAAGJ,CAAC,IAAI,CAACA,CAAC,CAACK,oBAAvC,CALoB,CAMpB;;;AACA,MAAIC,SAAS,GAAG,EAAhB;AACAT,EAAAA,OAAO,GAAGA,OAAO,CAACU,MAAR,CAAeP,CAAC,IAAI;AAC5B,UAAMQ,KAAK,GAAGN,mBAAmB,CAACF,CAAD,CAAjC;;AACA,QAAIM,SAAS,CAACP,eAAe,CAACC,CAAD,CAAhB,CAAb,EAAmC;AACjC,YAAMS,cAAc,GAAGD,KAAK,GAAGF,SAAS,CAACP,eAAe,CAACC,CAAD,CAAhB,CAAxC;AACA,UAAI,CAACS,cAAL,EAAqB,OAAO,KAAP;AACtB;;AACDH,IAAAA,SAAS,CAACP,eAAe,CAACC,CAAD,CAAhB,CAAT,GAAgCQ,KAAhC;AACA,WAAON,mBAAmB,CAACF,CAAD,CAAnB,GAAyB,EAAhC;AACD,GARS,CAAV;;AASA,QAAMU,YAAY,GAAGV,CAAC,IAAI,CAACA,CAAC,CAACW,aAAH,GAAmBT,mBAAmB,CAACF,CAAD,CAAhE;;AACAH,EAAAA,OAAO,GAAGA,OAAO,CAACU,MAAR,CAAeP,CAAC,IACxBU,YAAY,CAACV,CAAD,CAAZ,IAAmB,CAAC,EAApB,IACGU,YAAY,CAACV,CAAD,CAAZ,IAAmB,EAFd,CAAV;;AAIA,QAAMY,SAAS,GAAGZ,CAAC,IAAIA,CAAC,CAACa,MAAzB,CAtBoB,CAuBtB;;;AACE,QAAMC,KAAK,GAAG,GAAd;AACA,MAAIC,UAAU,GAAG;AACfD,IAAAA,KAAK,EAAEA,KADQ;AAEfE,IAAAA,MAAM,EAAEF,KAAK,GAAG,GAFD;AAGfG,IAAAA,MAAM,EAAE;AACNC,MAAAA,GAAG,EAAE,EADC;AAENC,MAAAA,KAAK,EAAE,EAFD;AAGNC,MAAAA,MAAM,EAAE,EAHF;AAINC,MAAAA,IAAI,EAAE;AAJA;AAHO,GAAjB;AAUAN,EAAAA,UAAU,CAACO,YAAX,GAA0BP,UAAU,CAACD,KAAX,GAAmBC,UAAU,CAACE,MAAX,CAAkBI,IAArC,GAA4CN,UAAU,CAACE,MAAX,CAAkBE,KAAxF;AACAJ,EAAAA,UAAU,CAACQ,aAAX,GAA2BR,UAAU,CAACC,MAAX,GAAoBD,UAAU,CAACE,MAAX,CAAkBC,GAAtC,GAA4CH,UAAU,CAACE,MAAX,CAAkBG,MAAzF,CApCoB,CAqCtB;;AACE,QAAMI,OAAO,GAAGpC,EAAE,CAACI,MAAH,CAAU,UAAV,EACbG,MADa,CACN,KADM,EAEXC,IAFW,CAEN,OAFM,EAEGmB,UAAU,CAACD,KAFd,EAGXlB,IAHW,CAGN,QAHM,EAGImB,UAAU,CAACC,MAHf,CAAhB;AAIA,QAAMS,MAAM,GAAGD,OAAO,CAAC7B,MAAR,CAAe,GAAf,EACV+B,KADU,CACJ,WADI,EACU,aAAYX,UAAU,CAACE,MAAX,CAAkBI,IAAK,OAAMN,UAAU,CAACE,MAAX,CAAkBC,GAAI,KADzE,CAAf;AAEA,QAAMS,UAAU,GAAGF,MAAM,CAAC9B,MAAP,CAAc,GAAd,CAAnB,CA5CoB,CA6CpB;;AACA8B,EAAAA,MAAM,CAAC9B,MAAP,CAAc,GAAd,EACKC,IADL,CACU,OADV,EACmB,MADnB;AAEA6B,EAAAA,MAAM,CAAC9B,MAAP,CAAc,MAAd,EACKC,IADL,CACU,OADV,EACmB,MADnB;AAEA6B,EAAAA,MAAM,CAAC9B,MAAP,CAAc,GAAd,EACKC,IADL,CACU,OADV,EACmB,QADnB,EAEK8B,KAFL,CAEW,WAFX,EAEyB,cAAaX,UAAU,CAACQ,aAAc,KAF/D,EAGG5B,MAHH,CAGU,MAHV,EAIKC,IAJL,CAIU,OAJV,EAImB,cAJnB,EAlDoB,CAuDtB;;AACE,QAAMgC,MAAM,GAAGxC,EAAE,CAACyC,WAAH,GACZC,MADY,CACL1C,EAAE,CAAC2C,MAAH,CAAUlC,OAAV,EAAmBa,YAAnB,CADK,EAEZsB,KAFY,CAEN,CAAC,CAAD,EAAIjB,UAAU,CAACO,YAAf,CAFM,EAGZW,IAHY,EAAf;AAIA,QAAMC,aAAa,GAAG9C,EAAE,CAAC+C,SAAH,GACnBL,MADmB,CACZF,MAAM,CAACE,MAAP,EADY,EAEnBM,KAFmB,CAEb1B,YAFa,EAGnB2B,UAHmB,CAGR,EAHQ,CAAtB;AAIA,QAAMC,IAAI,GAAGJ,aAAa,CAACrC,OAAD,CAA1B;AACA,QAAM0C,MAAM,GAAGnD,EAAE,CAACyC,WAAH,GACZC,MADY,CACL,CAAC,CAAD,EAAI1C,EAAE,CAACoD,GAAH,CAAOF,IAAP,EAAa1B,SAAb,CAAJ,CADK,EAEZoB,KAFY,CAEN,CAACjB,UAAU,CAACQ,aAAZ,EAA2B,CAA3B,CAFM,EAGZU,IAHY,EAAf,CAjEoB,CAqEtB;;AACE,QAAMQ,UAAU,GAAG,GAAnB;AACA,MAAIC,SAAS,GAAGjB,MAAM,CAACjC,MAAP,CAAc,OAAd,EACbmD,SADa,CACH,MADG,EAEbC,IAFa,CAERN,IAFQ,CAAhB;AAGAI,EAAAA,SAAS,CAACG,IAAV,GACKC,MADL;AAEA,QAAMC,YAAY,GAAGL,SAAS,CAACM,KAAV,GAAkBrD,MAAlB,CAAyB,GAAzB,EAChBC,IADgB,CACX,OADW,EACF,KADE,CAArB;AAEAmD,EAAAA,YAAY,CAACpD,MAAb,CAAoB,MAApB,EA9EoB,CA+EpB;;AACA+C,EAAAA,SAAS,GAAGK,YAAY,CAACE,KAAb,CAAmBP,SAAnB,CAAZ;AACA,QAAMQ,QAAQ,GAAGR,SAAS,CAAClD,MAAV,CAAiB,MAAjB,EACZI,IADY,CACP,KADO,EACA,CAACI,CAAD,EAAImD,CAAJ,KAAUA,CADV,EAEZvD,IAFY,CAEP,GAFO,EAEFI,CAAC,IAAI4B,MAAM,CAAC5B,CAAC,CAACoD,EAAH,CAAN,GAAeX,UAFlB,EAGZ7C,IAHY,CAGP,GAHO,EAGFI,CAAC,IAAIuC,MAAM,CAAC3B,SAAS,CAACZ,CAAD,CAAV,CAHT,EAIZJ,IAJY,CAIP,QAJO,EAIGI,CAAC,IAAIe,UAAU,CAACQ,aAAX,GAA2BgB,MAAM,CAAC3B,SAAS,CAACZ,CAAD,CAAV,CAJzC,EAKZJ,IALY,CAKP,OALO,EAKEI,CAAC,IAAIZ,EAAE,CAACoD,GAAH,CAAO,CACzB,CADyB,EAEzBZ,MAAM,CAAC5B,CAAC,CAACqD,EAAH,CAAN,GAAezB,MAAM,CAAC5B,CAAC,CAACoD,EAAH,CAArB,GAA8BX,UAFL,CAAP,CALP,CAAjB;AASA,QAAMa,IAAI,GAAGlE,EAAE,CAACkE,IAAH,CAAQzD,OAAR,EAAiBa,YAAjB,CAAb;AACA,QAAM6C,QAAQ,GAAG9B,MAAM,CAACkB,SAAP,CAAiB,OAAjB,EACZ/C,IADY,CACP,IADO,EACDgC,MAAM,CAAC0B,IAAD,CADL,EAEZ1D,IAFY,CAEP,IAFO,EAEDgC,MAAM,CAAC0B,IAAD,CAFL,EAGZ1D,IAHY,CAGP,IAHO,EAGD,CAAC,EAHA,EAIZA,IAJY,CAIP,IAJO,EAIDmB,UAAU,CAACQ,aAJV,CAAjB;AAKA,QAAMiC,SAAS,GAAG/B,MAAM,CAAC9B,MAAP,CAAc,MAAd,EACbC,IADa,CACR,OADQ,EACC,YADD,EAEbA,IAFa,CAER,GAFQ,EAEHgC,MAAM,CAAC0B,IAAD,CAFH,EAGb1D,IAHa,CAGR,GAHQ,EAGH,CAAC,EAHE,EAIb6D,IAJa,CAIR,MAJQ,CAAlB,CAhGoB,CAqGtB;;AACE,QAAMC,cAAc,GAAGtE,EAAE,CAACuE,UAAH,GACpBC,KADoB,CACdhC,MADc,CAAvB;AAEA,QAAMiC,KAAK,GAAGpC,MAAM,CAACjC,MAAP,CAAc,SAAd,EACXsE,IADW,CACNJ,cADM,CAAd;AAEA,QAAMK,UAAU,GAAGF,KAAK,CAACrE,MAAN,CAAa,eAAb,EACdI,IADc,CACT,GADS,EACJmB,UAAU,CAACO,YAAX,GAA0B,CADtB,EAEd1B,IAFc,CAET,GAFS,EAEJmB,UAAU,CAACE,MAAX,CAAkBG,MAAlB,GAA2B,EAFvB,EAGdqC,IAHc,CAGT,sBAHS,CAAnB;AAIA,QAAMO,cAAc,GAAGrC,UAAU,CAAChC,MAAX,CAAkB,MAAlB,EAClBC,IADkB,CACb,OADa,EACJ,iCADI,EAElBA,IAFkB,CAEb,GAFa,EAER,CAAC,EAFO,EAGlBA,IAHkB,CAGb,OAHa,EAGJmB,UAAU,CAACO,YAAX,GAA0B,CAHtB,EAIlB1B,IAJkB,CAIb,QAJa,EAIHmB,UAAU,CAACQ,aAAX,GAA2B,EAJxB,CAAvB;AAKA,QAAM0C,eAAe,GAAGtC,UAAU,CAAChC,MAAX,CAAkB,MAAlB,EACnBC,IADmB,CACd,OADc,EACL,kCADK,EAEnBA,IAFmB,CAEd,GAFc,EAETmB,UAAU,CAACO,YAAX,GAA0B,CAA1B,GAA8B,CAFrB,EAGnB1B,IAHmB,CAGd,GAHc,EAGT,CAAC,EAHQ,EAInBA,IAJmB,CAId,OAJc,EAILmB,UAAU,CAACO,YAAX,GAA0B,CAA1B,GAA8B,CAJzB,EAKnB1B,IALmB,CAKd,QALc,EAKJmB,UAAU,CAACQ,aAAX,GAA2B,EALvB,CAAxB;AAMA,QAAM2C,aAAa,GAAGvC,UAAU,CAAChC,MAAX,CAAkB,MAAlB,EACjBC,IADiB,CACZ,OADY,EACH,uBADG,EAEjBA,IAFiB,CAEZ,GAFY,EAEP,EAFO,EAGjBA,IAHiB,CAGZ,GAHY,EAGP,CAHO,EAIjB6D,IAJiB,CAIZ,iBAJY,CAAtB;AAKA,QAAMU,cAAc,GAAGxC,UAAU,CAAChC,MAAX,CAAkB,MAAlB,EAClBC,IADkB,CACb,OADa,EACJ,wBADI,EAElBA,IAFkB,CAEb,GAFa,EAERmB,UAAU,CAACO,YAAX,GAA0B,EAFlB,EAGlB1B,IAHkB,CAGb,GAHa,EAGR,CAHQ,EAIlB6D,IAJkB,CAIb,gBAJa,CAAvB,CA9HoB,CAmItB;;AACE,QAAMW,iBAAiB,GAAG3C,MAAM,CAACkB,SAAP,CAAiB,YAAjB,EACvBC,IADuB,CAClBN,IADkB,EAEvBU,KAFuB,GAEfrD,MAFe,CAER,MAFQ,EAGrBC,IAHqB,CAGhB,OAHgB,EAGP,WAHO,EAIrBA,IAJqB,CAIhB,GAJgB,EAIXI,CAAC,IAAI4B,MAAM,CAAC5B,CAAC,CAACoD,EAAH,CAJA,EAKrBxD,IALqB,CAKhB,GALgB,EAKX,CAACmB,UAAU,CAACE,MAAX,CAAkBC,GALR,EAMrBtB,IANqB,CAMhB,QANgB,EAMNmB,UAAU,CAACQ,aAAX,GAA2BR,UAAU,CAACE,MAAX,CAAkBC,GANvC,EAOrBtB,IAPqB,CAOhB,OAPgB,EAOPI,CAAC,IAAIZ,EAAE,CAACoD,GAAH,CAAO,CACzB,CADyB,EAEzBZ,MAAM,CAAC5B,CAAC,CAACqD,EAAH,CAAN,GAAezB,MAAM,CAAC5B,CAAC,CAACoD,EAAH,CAFI,CAAP,CAPE,EAWrBiB,EAXqB,CAWlB,YAXkB,EAWJC,YAXI,EAYrBD,EAZqB,CAYlB,YAZkB,EAYJE,YAZI,CAA1B;AAaA,QAAMC,OAAO,GAAGpF,EAAE,CAACI,MAAH,CAAU,UAAV,CAAhB;;AACA,WAAS8E,YAAT,CAAsBG,KAAtB,EAA6BC,KAA7B,EAAoC;AAClCF,IAAAA,OAAO,CAAChF,MAAR,CAAe,QAAf,EACKiE,IADL,CACU,CACFgB,KAAK,CAACrB,EAAN,GAAW,CAAX,GAAgB,oBAAhB,GAAuC,mBADrC,EAEJuB,IAAI,CAACC,GAAL,CAASH,KAAK,CAACrB,EAAf,CAFI,EAGJ,IAHI,EAIJuB,IAAI,CAACC,GAAL,CAASH,KAAK,CAACpB,EAAf,CAJI,EAKJ,OALI,EAMJwB,IANI,CAMC,GAND,CADV;AAQAL,IAAAA,OAAO,CAAChF,MAAR,CAAe,WAAf,EACKsF,IADL,CAEML,KAAK,CACFM,KADH,CACS,CADT,EACY,CADZ,EAEGC,GAFH,CAEOjF,eAFP,EAGG8E,IAHH,CAGQ,QAHR,CAFN;AAOAL,IAAAA,OAAO,CAAChF,MAAR,CAAe,QAAf,EACGiE,IADH,CACQkB,IAAI,CAACnC,GAAL,CAAS,CAAT,EAAY5B,SAAS,CAAC6D,KAAD,CAAT,GAAmB,CAA/B,CADR;AAEA,UAAMQ,2BAA2B,GAAGR,KAAK,CAACO,GAAN,CAAUhF,CAAC,IAC5CI,sBAAsB,CAACJ,CAAD,CAAtB,GAA4BE,mBAAmB,CAACF,CAAD,CAAhD,IAAwD,CADtB,CAApC;AAGA,UAAMkF,qBAAqB,GAAG9F,EAAE,CAACkE,IAAH,CAAQ2B,2BAAR,CAA9B;;AACA,UAAME,WAAW,GAAGnF,CAAC,IAAIZ,EAAE,CAACgG,MAAH,CAAU,MAAV,EAAkBT,IAAI,CAACC,GAAL,CAAS5E,CAAT,CAAlB,CAAzB;;AACAwE,IAAAA,OAAO,CAAChF,MAAR,CAAe,oBAAf,EACGiE,IADH,CACQ0B,WAAW,CAACD,qBAAD,CADnB;AAEAV,IAAAA,OAAO,CAAChF,MAAR,CAAe,qBAAf,EACGkC,KADH,CACS,OADT,EACmB,GAAEwD,qBAAqB,GAAG,GAAI,GADjD;AAEA,UAAMG,CAAC,GAAGzD,MAAM,CAAC6C,KAAK,CAACrB,EAAP,CAAN,GACN,CAACxB,MAAM,CAAC6C,KAAK,CAACpB,EAAP,CAAN,GAAmBzB,MAAM,CAAC6C,KAAK,CAACrB,EAAP,CAA1B,IAAwC,CADlC,GAENrC,UAAU,CAACE,MAAX,CAAkBI,IAFtB;AAGA,UAAMiE,CAAC,GAAG/C,MAAM,CAAC3B,SAAS,CAAC6D,KAAD,CAAV,CAAN,GACN1D,UAAU,CAACE,MAAX,CAAkBC,GADtB;AAEAsD,IAAAA,OAAO,CAAC9C,KAAR,CAAc,WAAd,EAA4B,YAAD,GACtB,gBAAe2D,CAAE,MADK,GAEtB,gBAAeC,CAAE,KAFK,GAGtB,GAHL;AAIAd,IAAAA,OAAO,CAAC9C,KAAR,CAAc,SAAd,EAAyB,CAAzB;AACA,UAAM6D,UAAU,GAAG7C,SAAS,CAAClD,MAAV,CAAkB,aAAYkF,KAAM,IAApC,CAAnB;AACAa,IAAAA,UAAU,CAACC,OAAX,CAAmB,SAAnB,EAA8B,IAA9B;AACD;;AACD,WAASjB,YAAT,GAAwB;AACtBC,IAAAA,OAAO,CAAC9C,KAAR,CAAc,SAAd,EAAyB,CAAzB;AACAwB,IAAAA,QAAQ,CAACsC,OAAT,CAAiB,SAAjB,EAA4B,KAA5B;AACD;AACF;;AACL,eAAenG,MAAf","sourcesContent":["import React, {useRef, useEffect, useState} from 'react'\nimport * as d3 from 'd3'\n\nconst Circle = () => {\n    const ref = useRef()\n    useEffect(() => { // runs d3 code when the Component mounths\n        const svgElement = d3.select(ref.current) // turn our ref into d3 object\n        drawBars()\n        svgElement.append(\"circle\") //append a circle\n            .attr(\"cx\", 150)\n            .attr(\"cy\", 70)\n            .attr(\"r\", 50)\n    }, [])\n    return (\n           <svg\n            ref={ref}\n           />\n\n    )\n}\nasync function drawBars() {\n    // 1. Access data\n      let dataset = await d3.csv(\"../utils/data.csv\")\n      const summaryAccessor = d => d.Summary\n      const actualHoursAccessor = d => +d.HoursActual\n      const developerHoursAccessor = d => +d.DeveloperHoursActual\n      // Only use the first estimate per task (with highest actual hours)\n      let usedTasks = {}\n      dataset = dataset.filter(d => {\n        const hours = actualHoursAccessor(d)\n        if (usedTasks[summaryAccessor(d)]) {\n          const hasHigherValue = hours > usedTasks[summaryAccessor(d)]\n          if (!hasHigherValue) return false\n        }\n        usedTasks[summaryAccessor(d)] = hours\n        return actualHoursAccessor(d) > 10\n      })\n      const diffAccessor = d => +d.HoursEstimate - actualHoursAccessor(d)\n      dataset = dataset.filter(d => (\n        diffAccessor(d) >= -50\n        && diffAccessor(d) <= 50\n      ))\n      const yAccessor = d => d.length\n    // 2. Create chart dimensions\n      const width = 600\n      let dimensions = {\n        width: width,\n        height: width * 0.5,\n        margin: {\n          top: 35,\n          right: 10,\n          bottom: 50,\n          left: 50,\n        },\n      }\n      dimensions.boundedWidth = dimensions.width - dimensions.margin.left - dimensions.margin.right\n      dimensions.boundedHeight = dimensions.height - dimensions.margin.top - dimensions.margin.bottom\n    // 3. Draw canvas\n      const wrapper = d3.select(\"#wrapper\")\n        .append(\"svg\")\n          .attr(\"width\", dimensions.width)\n          .attr(\"height\", dimensions.height)\n      const bounds = wrapper.append(\"g\")\n          .style(\"transform\", `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`)\n      const background = bounds.append(\"g\")\n      // init static elements\n      bounds.append(\"g\")\n          .attr(\"class\", \"bins\")\n      bounds.append(\"line\")\n          .attr(\"class\", \"mean\")\n      bounds.append(\"g\")\n          .attr(\"class\", \"x-axis\")\n          .style(\"transform\", `translateY(${dimensions.boundedHeight}px)`)\n        .append(\"text\")\n          .attr(\"class\", \"x-axis-label\")\n    // 4. Create scales\n      const xScale = d3.scaleLinear()\n        .domain(d3.extent(dataset, diffAccessor))\n        .range([0, dimensions.boundedWidth])\n        .nice()\n      const binsGenerator = d3.histogram()\n        .domain(xScale.domain())\n        .value(diffAccessor)\n        .thresholds(30)\n      const bins = binsGenerator(dataset)\n      const yScale = d3.scaleLinear()\n        .domain([0, d3.max(bins, yAccessor)])\n        .range([dimensions.boundedHeight, 0])\n        .nice()\n    // 5. Draw data\n      const barPadding = 1.5\n      let binGroups = bounds.select(\".bins\")\n        .selectAll(\".bin\")\n        .data(bins)\n      binGroups.exit()\n          .remove()\n      const newBinGroups = binGroups.enter().append(\"g\")\n          .attr(\"class\", \"bin\")\n      newBinGroups.append(\"rect\")\n      // update binGroups to include new points\n      binGroups = newBinGroups.merge(binGroups)\n      const barRects = binGroups.select(\"rect\")\n          .attr(\"key\", (d, i) => i)\n          .attr(\"x\", d => xScale(d.x0) + barPadding)\n          .attr(\"y\", d => yScale(yAccessor(d)))\n          .attr(\"height\", d => dimensions.boundedHeight - yScale(yAccessor(d)))\n          .attr(\"width\", d => d3.max([\n            0,\n            xScale(d.x1) - xScale(d.x0) - barPadding\n          ]))\n      const mean = d3.mean(dataset, diffAccessor)\n      const meanLine = bounds.selectAll(\".mean\")\n          .attr(\"x1\", xScale(mean))\n          .attr(\"x2\", xScale(mean))\n          .attr(\"y1\", -20)\n          .attr(\"y2\", dimensions.boundedHeight)\n      const meanLabel = bounds.append(\"text\")\n          .attr(\"class\", \"mean-label\")\n          .attr(\"x\", xScale(mean))\n          .attr(\"y\", -25)\n          .text(\"mean\")\n    // 6. Draw peripherals\n      const xAxisGenerator = d3.axisBottom()\n        .scale(xScale)\n      const xAxis = bounds.select(\".x-axis\")\n        .call(xAxisGenerator)\n      const xAxisLabel = xAxis.select(\".x-axis-label\")\n          .attr(\"x\", dimensions.boundedWidth / 2)\n          .attr(\"y\", dimensions.margin.bottom - 10)\n          .text(\"Hours over-estimated\")\n      const backgroundLeft = background.append(\"rect\")\n          .attr(\"class\", \"background left-side-background\")\n          .attr(\"y\", -20)\n          .attr(\"width\", dimensions.boundedWidth / 2)\n          .attr(\"height\", dimensions.boundedHeight + 20)\n      const backgroundRight = background.append(\"rect\")\n          .attr(\"class\", \"background right-side-background\")\n          .attr(\"x\", dimensions.boundedWidth / 2 + 1)\n          .attr(\"y\", -20)\n          .attr(\"width\", dimensions.boundedWidth / 2 - 1)\n          .attr(\"height\", dimensions.boundedHeight + 20)\n      const leftSideLabel = background.append(\"text\")\n          .attr(\"class\", \"label left-side-label\")\n          .attr(\"x\", 10)\n          .attr(\"y\", 0)\n          .text(\"Under-estimated\")\n      const rightSideLabel = background.append(\"text\")\n          .attr(\"class\", \"label right-side-label\")\n          .attr(\"x\", dimensions.boundedWidth - 10)\n          .attr(\"y\", 0)\n          .text(\"Over-estimated\")\n    // 7. Set up interactions\n      const barRectsListeners = bounds.selectAll(\".listeners\")\n        .data(bins)\n        .enter().append(\"rect\")\n          .attr(\"class\", \"listeners\")\n          .attr(\"x\", d => xScale(d.x0))\n          .attr(\"y\", -dimensions.margin.top)\n          .attr(\"height\", dimensions.boundedHeight + dimensions.margin.top)\n          .attr(\"width\", d => d3.max([\n            0,\n            xScale(d.x1) - xScale(d.x0)\n          ]))\n          .on(\"mouseenter\", onMouseEnter)\n          .on(\"mouseleave\", onMouseLeave)\n      const tooltip = d3.select(\"#tooltip\")\n      function onMouseEnter(datum, index) {\n        tooltip.select(\"#range\")\n            .text([\n                datum.x0 < 0 ? `Under-estimated by` : `Over-estimated by`,\n              Math.abs(datum.x0),\n              \"to\",\n              Math.abs(datum.x1),\n              \"hours\",\n            ].join(\" \"))\n        tooltip.select(\"#examples\")\n            .html(\n              datum\n                .slice(0, 3)\n                .map(summaryAccessor)\n                .join(\"<br />\")\n              )\n        tooltip.select(\"#count\")\n          .text(Math.max(0, yAccessor(datum) - 2))\n        const percentDeveloperHoursValues = datum.map(d => (\n          (developerHoursAccessor(d) / actualHoursAccessor(d)) || 0\n        ))\n        const percentDeveloperHours = d3.mean(percentDeveloperHoursValues)\n        const formatHours = d => d3.format(\",.2f\")(Math.abs(d))\n        tooltip.select(\"#tooltip-bar-value\")\n          .text(formatHours(percentDeveloperHours))\n        tooltip.select(\"#tooltip-bar-item-1\")\n          .style(\"width\", `${percentDeveloperHours * 100}%`)\n        const x = xScale(datum.x0)\n          + (xScale(datum.x1) - xScale(datum.x0)) / 2\n          + dimensions.margin.left\n        const y = yScale(yAccessor(datum))\n          + dimensions.margin.top\n        tooltip.style(\"transform\", `translate(`\n          + `calc( -50% + ${x}px),`\n          + `calc(-100% + ${y}px)`\n          + `)`)\n        tooltip.style(\"opacity\", 1)\n        const hoveredBar = binGroups.select(`rect[key='${index}']`)\n        hoveredBar.classed(\"hovered\", true)\n      }\n      function onMouseLeave() {\n        tooltip.style(\"opacity\", 0)\n        barRects.classed(\"hovered\", false)\n      }\n    }\nexport default Circle\n"]},"metadata":{},"sourceType":"module"}